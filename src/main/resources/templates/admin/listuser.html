<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A fully featured admin theme which can be used to build CRM, CMS, etc.">
    <meta name="author" content="Coderthemes">

    <link rel="shortcut icon" th:href="@{../assets/images/favicon.ico}">

    <title>Megalodon</title>


    <!-- App css -->
    <link th:href="@{../assets/css/bootstrap.min.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{../assets/css/core.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{../assets/css/components.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{../assets/css/icons.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{../assets/css/pages.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{../assets/css/menu.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{../assets/css/responsive.css}" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" th:href="@{../plugins/switchery/switchery.min.css}">

    <!-- HTML5 Shiv and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="../assets/js/modernizr.min.js"></script>

</head>


<body>


    <!-- Navigation Bar-->
    <div th:insert="fragments/frAdmin :: header"></div>
    <!-- End Navigation Bar-->


    <div class="wrapper">
        <div class="container">


            <!-- infor User -->

            <div class="row" style="display: flex; justify-content: center;">


                <div class="col-sm-12 col-xs-12 col-md-6">
                    <div class="card-box">
                        <h4 class="header-title m-t-0">INFORMATION USER</h4>
                        <div class="row">
                            <form method="post" v-on:submit.prevent="postUser" data-parsley-validate novalidate>
                                <div class="form-group">
                                    <p class="text-muted font-13 m-b-15 m-t-20">Role</p>
                                    <div class="radio radio-info radio-inline">
                                        <input type="radio" id="inlineRadio1" value="1" name="role" v-model="role_id">
                                        <label for="inlineRadio1"> Admin </label>
                                    </div>
                                    <div class="radio radio-inline">
                                        <input type="radio" id="inlineRadio2" value="2" name="role" v-model="role_id">
                                        <label for="inlineRadio2"> Employee </label>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="userName">Username<span class="text-danger">*</span></label>
                                    <input type="text" name="usernameUsers" parsley-trigger="change" required
                                        placeholder="Enter Username" class="form-control" id="userName"
                                        v-model="usernameUsers_">
                                </div>
                                <div class="form-group" v-if="!idUsers_">
                                
                                    <label for="userName">Password<span class="text-danger">*</span></label>
                                    <input type="text" name="passwordUsers" parsley-trigger="change" required
                                        placeholder="Enter Password" class="form-control" id="passwordUsers"
                                        v-model="passwordUsers_">
                                </div>
                              <!--   <div class="form-group">
                                    <label for="userName">Check Password<span class="text-danger">*</span></label>
                                    <input type="text" name="passwordcheck" parsley-trigger="change" required
                                        placeholder="Enter Password Again" class="form-control" id="passwordcheck"
                                        >
                                </div>  -->
                                <div class="form-group">
                                    <label for="userName">Full Name<span class="text-danger">*</span></label>
                                    <input type="text" name="nameUsers" parsley-trigger="change" required
                                        placeholder="Enter your name" class="form-control" id="FullName"
                                        v-model="nameUsers_">
                                </div>

                                <div class="form-group">
                                    <label for="emailAddress">BirthDay<span class="text-danger">*</span></label>

                                    <div class="input-group">
                                        <input type="date" class="form-control" id="" name="dateOfBirthday"
                                            v-model="dateOfBirthday_">
                                        <input type="hidden" class="form-control" id="" name="idUsers"
                                            v-model="idUsers_">
                                    </div>
                                    <div class="form-group">
                                        <label for="Phone">Phone<span class="text-danger">*</span></label>
                                        <input type="text" name="phoneUsers" parsley-trigger="change" required
                                            placeholder="Enter Your Phone" class="form-control" id="Phone"
                                            v-model="phoneUsers_">
                                    </div>
                                    <div class="form-group">
                                        <label for="passWord2">Email<span class="text-danger">*</span></label>
                                        <input type="email" name="email_users" parsley-trigger="change" required
                                            placeholder="Enter Your Email" class="form-control" id="Email"
                                            v-model="emailUsers_">
                                    </div>
                                    <div class="form-group">
                                        <label for="Address">Address<span class="text-danger">*</span></label>
                                        <input type="text" name="addressUsers" parsley-trigger="change" required
                                            placeholder="Enter Address" class="form-control" id="Address"
                                            v-model="addressUsers_">
                                    </div>

                                    <div class="form-group text-right m-b-0">
                                        <input class="btn btn-primary " type="submit" id="save" value="Create/Edit">




                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

            </div>
            <!-- end infor User -->


            <div class="row">
                <div class="col-sm-12">

                    <div class="panel">

                        <div class="panel-body">
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="m-b-30">
                                        <h4 class="header-title m-t-0">LIST USERS</h4>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="m-b-30">
                                        <form>
                                            <input name="nameuser" type="text" id="search-input"
                                                class="form-control product-search"
                                                placeholder="Input Name want to Search here ..." v-model="search">
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div class="">
                                <table class="table table-striped add-edit-table table-bordered"
                                    id="datatable-editable">
                                    <thead>
                                        <tr>
                                            <th>UserName</th>
                                            <th>Full Name</th>
                                            <th>Email</th>
                                            <th>Phone</th>
                                            <th>Role</th>

                                            <th>Actions</th>
                                        </tr>
                                    </thead>

                                    <tbody>
                                        <tr class="gradeX" v-for="u in filteredUsers" v-if="u.role.idRole ==1 || u.role.idRole ==2 ">
                                            <td>{{u.usernameUsers}}</td>
                                            <td>{{u.nameUsers}}</td>
                                            <td>{{u.emailUsers}}</td>
                                            <td>{{u.phoneUsers}}</td>
                                            <td>{{u.role.nameRole}}</td>

                                            <td class="actions">
                                                <a v-on:click="editUser(u)"><i class="fa fa-pencil"></i></a>
                                                <a v-on:click="deleteUser(u)"><i class="fa fa-trash-o"></i></a>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                    <!--              <ul class="pagination pagination-split">
                                            <li class="disabled">
                                                <a href="#"><i class="fa fa-angle-left"></i></a>
                                            </li>
                                            <li class="active">
                                                <a href="#">1</a>
                                            </li>
                                            <li>
                                                <a href="#">2</a>
                                            </li>
                                            <li>
                                                <a href="#">3</a>
                                            </li>
                                            <li>
                                                <a href="#">4</a>
                                            </li>
                                            <li>
                                                <a href="#">5</a>
                                            </li>
                                            <li>
                                                <a href="#"><i class="fa fa-angle-right"></i></a>
                                            </li>
                                        </ul> -->
                            </div>
                        </div>
                        <!-- end: page -->

                    </div> <!-- end Panel -->

                </div>
            </div>


            <!-- Footer -->
            <footer class="footer text-right">
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12 text-center">
                            © Megalodon
                        </div>
                    </div>
                </div>
            </footer>
            <!-- End Footer -->

            <!-- Footer -->
            <footer class="footer text-right">
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12 text-center">
                            © Megalodon
                        </div>
                    </div>
                </div>
            </footer>
            <!-- End Footer -->

        </div>
    </div>
    <!-- jQuery  -->
    <script th:src="@{../assets/js/jquery.min.js}"></script>
    <script th:src="@{../assets/js/bootstrap.min.js}"></script>
    <script th:src="@{../assets/js/detect.js}"></script>
    <script th:src="@{../assets/js/fastclick.js}"></script>
    <script th:src="@{../assets/js/jquery.blockUI.js}"></script>
    <script th:src="@{../assets/js/waves.js}"></script>
    <script th:src="@{../assets/js/jquery.slimscroll.js}"></script>
    <script th:src="@{../assets/js/jquery.scrollTo.min.js}"></script>
    <script th:src="@{../plugins/switchery/switchery.min.js}"></script>

    <!-- Counter js  -->
    <script th:src="@{../plugins/waypoints/jquery.waypoints.min.js}"></script>
    <script th:src="@{../plugins/counterup/jquery.counterup.min.js}"></script>


    <!-- App js -->
    <script th:src="@{../assets/js/jquery.core.js}"></script>
    <script th:src="@{../assets/js/jquery.app.js}"></script>


</body>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://vuejs.org/js/vue.js"></script>
<script>
    var app = new Vue({
        el: '.wrapper',
        data() {
            return {
                users: [],
                idUsers_: '',
                nameUsers_: '',
                usernameUsers_: '',
                emailUsers_: '',
                phoneUsers_: '',
                addressUsers_: '',
                role_id: '',
                dateOfBirthday_: '',
                passwordUsers_: '',
                imageUsers_: '',
                search: '',
            }
        },

        mounted() {
            this.fetchUser();
        },
        methods: {
            fetchUser: function () {
                axios.get("http://localhost:8080/api/user").then(response => (
                    this.users = response.data))
            },

            postUser: function (event) {
                // Creating
                if (this.idUsers_ == '' || this.idUsers_ == null) {
                    axios
                        .post("http://localhost:8080/api/adduser", {
                            "nameUsers": this.nameUsers_,
                            "emailUsers": this.emailUsers_,
                            "usernameUsers": this.usernameUsers_,
                            "phoneUsers": this.phoneUsers_,
                            "addressUsers": this.addressUsers_,
                            "role": {
                                "idRole": this.role_id,

                            },
                            "dateOfBirthday": this.dateOfBirthday_,
                            "passwordUsers": this.passwordUsers_,
                            "imageUsers": this.imageUsers_,
                            
                        })
                        .then(savedRole => {
                            this.users.push(savedRole.data);
                            this.emailUsers_ = '';
                            this.usernameUsers_ = '';
                            this.nameUsers_ = '';
                            this.phoneUsers_ = '';
                            this.idUsers_ = '';
                            this.addressUsers_ = '';
                            this.role_ = '';
                            this.dateOfBirthday_ = '';
                            this.passwordUsers_ = '';
                            this.imageUsers_ = '';
                            this.fetchUser();
                        })
                        this.fetchUser()
                } else { // Updating
                    axios
                        .post("http://localhost:8080/api/adduser", {
                            "idUsers": this.idUsers_,
                            "nameUsers": this.nameUsers_,
                            "emailUsers": this.emailUsers_,
                            "usernameUsers": this.usernameUsers_,
                            "phoneUsers": this.phoneUsers_,
                            "addressUsers": this.addressUsers_,
                            "role": {
                                "idRole": this.role_id,

                            },
                            "dateOfBirthday": this.dateOfBirthday_,
                           "passwordUsers": this.passwordUsers_,
                            "imageUsers": this.imageUsers_,
                        })
                        .then(savedUser => {
                            this.fetchUser();
                            this.emailUsers_ = '';
                            this.usernameUsers_ = '';
                            this.nameUsers_ = '';
                            this.idUsers_ = '';
                            this.phoneUsers_ = '';
                            this.addressUsers_ = '';
                            this.role_ = '';
                            this.dateOfBirthday_ = '';
                           this.passwordUsers_='';
                            this.imageUsers_ = '';
                        })
                        
                }
            },
            editUser: function (u) {
                this.idUsers_ = u.idUsers;
                this.nameUsers_ = u.nameUsers;
                this.emailUsers_ = u.emailUsers;
                this.usernameUsers_ = u.usernameUsers;
                this.phoneUsers_ = u.phoneUsers;
                this.addressUsers_ = u.addressUsers;
                this.role_id = u.role.idRole;
                this.dateOfBirthday_ = u.dateOfBirthday;
                this.passwordUsers_=u.passwordUsers
                this.imageUsers_ = u.imageUsers;


            },
            deleteUser: async function (id) {
                await axios
                    .delete("http://localhost:8080/api/delete/" + id.idUsers);
                this.fetchUser();
            },
        },
       computed: {
			filteredUsers: function (){
				return this.users.filter((u)=>{
					return u.nameUsers.toLowerCase().match(this.search.toLowerCase());
					})	
			}	
        }, 

    })


</script>

</html>